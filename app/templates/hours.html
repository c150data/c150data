

{% extends 'layout.html' %}
{% set active_page = "hours" %}
{% block content %}


<link href="https://unpkg.com/bootstrap-table@1.15.3/dist/bootstrap-table.min.css" rel="stylesheet">

<script src="https://unpkg.com/bootstrap-table@1.15.3/dist/bootstrap-table.min.js"></script>

<!--   <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.18/css/jquery.dataTables.min.css"/>
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script> -->

<script type="text/javascript" src="../static/js/hours.js"></script>
<link rel="stylesheet" href="../static/css/hours.css"/>

<style>
  .my-table {
      position: fixed;
      z-index: 1;
      margin-top: 480px;
      width: 100%;
      height: auto;
      background-color: grey;
      opacity: .9;
      color: white;
  }
</style>

<div class="hours-content">
  <div class="container-fluid">

    <div class="text-center" id="main-text">
      <h1>This is the Hours page.</h1>
      <p>Simply select the time period of which you want to see the completed hours and press enter!</p>
    </div>

    <div class="row text-center">
      <div class="col-lg-5 align-self-center">
        <div class="form-group">
          <div class="input-group date" id="datetimepickerStart"  data-target-input="nearest">
            <input type="text" placeholder="Start Date" id="startDateInput"
           class="form-control datetimepicker-input" data-target="#datetimepickerStart" />
            <div class="input-group-append" data-target="#datetimepickerStart" data-toggle="datetimepicker">
              <div class="input-group-text"><i class="fa fa-calendar"></i></div>
            </div>
          </div>
        </div>
      </div>
      <div class='col-lg-5 align-self-center'>
        <div class="form-group">
          <div class="input-group date" id="datetimepickerEnd" data-target-input="nearest">
            <input type="text" placeholder="End Date" id="endDateInput"
           class="form-control datetimepicker-input" data-target="#datetimepickerEnd" />
            <div class="input-group-append" data-target="#datetimepickerEnd" data-toggle="datetimepicker">
              <div class="input-group-text"><i class="fa fa-calendar"></i></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-2">
        <button id="button" type="submit" id="dataSubmitButton" class="btn btn-primary">
          <span id='spinner' class="spinner-border spinner-border-sm" role="status"></span>
          <span id='submitLabel'>Get Hours</span>
        </button>
      </div>
    </div>
  </div>

<!--   <div class="container">
    <div class="row" id="hours-table-div"></div>
  </div> -->

<div class="my-table">

<!-- <table
  class="display table table-striped"
  id="table"
  data-search=true> 
  data-only-info-pagination="true"-->
  <table
  id="table"
  class="table table-bordered table-hover table-striped"
  data-toggle="table"
  data-search="true"
  data-show-search-button="true"
  data-height="490"
  data-ajax="ajaxRequest"
  data-pagination="false"
  data-row-attributes="rowAttributes">
  <thead>
      <tr>
          <th data-field="rank">Rank</th>
          <th data-field="name">Name</th>
          <th data-field="rounded_hours">Hours</th>
      </tr>
  </thead>
</table>
</div>
</div>

<script>
  var $button = $('#button')
  var $table = $('#table')
  var firstTime = 1

  function getLastWeek() {
    var today = new Date();
    var lastWeek = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 7);
    var lastWeekMonth = lastWeek.getMonth() + 1;
    var lastWeekDay = lastWeek.getDate();
    var lastWeekYear = lastWeek.getFullYear();
    var lastWeekDisplayPadded = ("00" + lastWeekMonth.toString()).slice(-2) + "/" + ("00" + lastWeekDay.toString()).slice(-2) + "/" + ("0000" + lastWeekYear.toString()).slice(-4);
    return lastWeekDisplayPadded
    }
  function getToday() {
    var today = new Date();
    var todayMonth = today.getMonth()+1
    var todayDate = today.getDate()
    var todayYear = today.getFullYear()
    var lastWeek = getLastWeek();
    var todayDisplayPadded = ("00" + todayMonth.toString()).slice(-2) + "/" + ("00" + todayDate.toString()).slice(-2) + "/" + ("0000" + todayYear.toString()).slice(-4);
    return todayDisplayPadded
  }

  $(function() {
    $button.click(function () {
      // alert("refresh")
      firstTime = 0
      $table.bootstrapTable('refresh')
    })
  })

  function getData() {
    var on_load_start = getToday()
    var on_load_end = getLastWeek()
    var data = {
                    'start_date': on_load_start,
                    'end_date': on_load_end
                }
    if (!firstTime) {
      data = {
                'start_date': $("#startDateInput").val(),
                'end_date': $("#endDateInput").val()
              }
    }

    return data
  }

  function ajaxRequest(params) {
    // previous code that worked
    // var url = '/hours/getData'
    // $.get(url + '?' + $.param(params.data)).then(function (response) {
    //   params.success(response)
    // })
    $.ajax({
           url: '/hours/getData',
           type: "get",
           dataType: 'json',
           data: getData(), 
           success: function(response) {
               // alert('done');
               params.success(response)
           },
           error: function(e) {
              // alert('failure')
              log.info(e.responseText);
           }
        });
  }

  function rowAttributes(row, index) {
    return {
      'data-toggle': 'popover',
      'data-placement': 'bottom',
      'data-trigger': 'hover',
      'data-content': [
        'Rank: ' + row.rank,
        'Name: ' + row.name,
        'Hours: ' + row.rounded_hours
      ].join(', ')
    }
  }
    $(function() {
    $('#table').on('post-body.bs.table', function (e) {
      $('[data-toggle="popover"]').popover()
    })
  })

  $(function () {
        $('#datetimepickerStart').datetimepicker({
            format: 'L'
        });
        $('#datetimepickerEnd').datetimepicker({
            format: 'L',
            useCurrent: false
        });
        $("#datetimepickerStart").on("change.datetimepicker", function (e) {
            $('#datetimepickerEnd').datetimepicker('minDate', e.date);
        });
        $("#datetimepickerEnd").on("change.datetimepicker", function (e) {
            $('#datetimepickerStart').datetimepicker('maxDate', e.date);
        });
    });
</script>

<a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>

{% endblock content %}